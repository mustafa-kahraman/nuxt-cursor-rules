---
description: 
globs: 
alwaysApply: false
---
# Mongoose Modelleri KurallarÄ±

## ğŸ¯ Kural Tipi YapÄ±landÄ±rmasÄ±

### Birincil Kural Tipi SeÃ§imi
- [ ] Her zaman: Her istekte otomatik olarak uygulanÄ±r (Ã¶rn. kod stili, gÃ¼venlik kontrolleri)
- [x] Manuel: YalnÄ±zca manuel olarak Ã§aÄŸrÄ±ldÄ±ÄŸÄ±nda kullanÄ±lÄ±r (Ã¶rn. Ã¶zel kod oluÅŸturma ÅŸablonlarÄ±)
- [ ] Otomatik EklenmiÅŸ: Belirli dosyalar/durumlar iÃ§in otomatik olarak tetiklenir
- [ ] Ajan TarafÄ±ndan Ä°stenen: AI tarafÄ±ndan gerektiÄŸinde Ã§aÄŸrÄ±lÄ±r

type: manual
description: NuxtJS projelerinde Mongoose model ve ÅŸemalarÄ±nÄ±n yapÄ±sÄ±nÄ± ve uygulama standartlarÄ±nÄ± tanÄ±mlar.
globs: server/models/**/*.model.ts

## ğŸ“‹ Sorumluluklar

### Åema TanÄ±mÄ±
- Her model iÃ§in ayrÄ± bir `.model.ts` dosyasÄ± oluÅŸturun.
- Mongoose `Schema` sÄ±nÄ±fÄ±nÄ± kullanarak ÅŸemalarÄ± tanÄ±mlayÄ±n.
- Alan tiplerini (String, Number, Date, Boolean, ObjectId, Array, vb.) doÄŸru ÅŸekilde belirtin.
- Gerekli alanlar iÃ§in `required: true` kullanÄ±n.
- VarsayÄ±lan deÄŸerler iÃ§in `default` Ã¶zelliÄŸini kullanÄ±n.
- Benzersiz alanlar iÃ§in `unique: true` kullanÄ±n.
- Enum deÄŸerleri iÃ§in `enum` Ã¶zelliÄŸini kullanÄ±n.
- Referanslar (iliÅŸkiler) iÃ§in `type: Schema.Types.ObjectId` ve `ref: 'ReferansModelAdÄ±'` kullanÄ±n.
- GÃ¶mÃ¼lÃ¼ alt dÃ¶kÃ¼manlar iÃ§in ÅŸema iÃ§inde ÅŸema tanÄ±mlayÄ±n.

### DoÄŸrulama (Validation)
- Åema seviyesinde temel doÄŸrulamalarÄ± (minlength, maxlength, match, min, max) kullanÄ±n.
- Ã–zel doÄŸrulama mantÄ±ÄŸÄ± iÃ§in `validate` fonksiyonunu kullanÄ±n.

### Metotlar ve Statikler
- Ã–rnek (instance) metotlarÄ± iÃ§in `schema.methods` kullanÄ±n.
- Statik model metotlarÄ± iÃ§in `schema.statics` kullanÄ±n.
- Sanal (virtual) alanlar iÃ§in `schema.virtual` kullanÄ±n.

### Ä°ndeksler
- Performans iÃ§in gerekli alanlara indeks (`index: true`) ekleyin.
- BileÅŸik indeksler iÃ§in `schema.index({...})` kullanÄ±n.

### TypeScript Entegrasyonu
- Model arayÃ¼zÃ¼nÃ¼ (`interface`) tanÄ±mlayÄ±n.
- `mongoose.model<IModelArayuzu>('ModelAdÄ±', schema)` kullanarak modeli oluÅŸturun.

## ğŸ§© Anahtar BileÅŸenler
- Åema (`Schema`): Veri yapÄ±sÄ±nÄ± tanÄ±mlar.
- Model (`Model`): VeritabanÄ± ile etkileÅŸim arayÃ¼zÃ¼nÃ¼ saÄŸlar.
- ArayÃ¼z (`interface`): TypeScript tip gÃ¼venliÄŸi iÃ§in modelin yapÄ±sÄ±nÄ± tanÄ±mlar.
- Metotlar (`methods`, `statics`): Modele Ã¶zgÃ¼ iÅŸ mantÄ±ÄŸÄ±nÄ± iÃ§erir.
- Sanallar (`virtuals`): Hesaplanan veya birleÅŸtirilmiÅŸ alanlar oluÅŸturur.

## ğŸ“¦ BaÄŸÄ±mlÄ±lÄ±klar

### Gerekli Paketler
- `mongoose`: projenin kullandÄ±ÄŸÄ± sÃ¼rÃ¼m (yada @latest)

### Gerekli Kurallar
- Belki @types-schema-models.mdc (Genel tipler iÃ§in)

## âœ… DoÄŸru KullanÄ±m
```typescript
// server/models/user.model.ts
import mongoose, { Schema, Document, Model } from 'mongoose';

// 1. ArayÃ¼zÃ¼ TanÄ±mla (TypeScript iÃ§in)
export interface IUser extends Document {
  name: string;
  email: string;
  createdAt: Date;
  lastLogin?: Date;
  fullName(): string; // Ã–rnek metot
}

// 2. ÅemayÄ± OluÅŸtur
const UserSchema: Schema<IUser> = new Schema({
  name: {
    type: String,
    required: [true, 'Ä°sim alanÄ± zorunludur.'],
    trim: true,
  },
  email: {
    type: String,
    required: [true, 'E-posta alanÄ± zorunludur.'],
    unique: true,
    lowercase: true,
    trim: true,
    match: [/\S+@\S+\.\S+/, 'GeÃ§ersiz e-posta formatÄ±.'],
  },
  lastLogin: {
    type: Date,
  },
}, {
  timestamps: true // createdAt ve updatedAt alanlarÄ±nÄ± otomatik ekler
});

// 3. Sanal Alanlar (Ä°steÄŸe BaÄŸlÄ±)
UserSchema.virtual('id').get(function(){
    return this._id.toHexString();
});

// JSON'a dÃ¶nÃ¼ÅŸtÃ¼rÃ¼rken sanallarÄ± dahil et
UserSchema.set('toJSON', {
    virtuals: true
});

// 4. Ã–rnek MetotlarÄ± (Ä°steÄŸe BaÄŸlÄ±)
UserSchema.methods.fullName = function(): string {
  return this.name; // Basit Ã¶rnek, daha karmaÅŸÄ±k olabilir
};

// 5. Statik Metotlar (Ä°steÄŸe BaÄŸlÄ±)
UserSchema.statics.findByEmail = function(email: string) {
  return this.findOne({ email });
};

// 6. Ä°ndeksler (Ä°steÄŸe BaÄŸlÄ±)
UserSchema.index({ email: 1 }); // E-posta Ã¼zerinde indeks

// 7. Modeli OluÅŸtur ve DÄ±ÅŸa Aktar
// EÄŸer model zaten tanÄ±mlÄ±ysa tekrar tanÄ±mlamayÄ± Ã¶nle (HMR iÃ§in Ã¶nemli olabilir)
const UserModel = mongoose.models.User as Model<IUser> || mongoose.model<IUser>('User', UserSchema);

export default UserModel;

// KullanÄ±m Ã–rneÄŸi (API endpoint iÃ§inde)
// import UserModel from '@/server/models/user.model';
// const user = await UserModel.findByEmail('test@example.com');
// const newUser = new UserModel({ name: 'Test', email: 'test2@example.com' });
// await newUser.save();
// console.log(newUser.fullName());
```

## âŒ YanlÄ±ÅŸ KullanÄ±m
```typescript
// âŒ YANLIÅ: Åema olmadan doÄŸrudan model oluÅŸturma
// const User = mongoose.model('User', { name: String }); // Åema detaylarÄ± eksik

// âŒ YANLIÅ: TypeScript arayÃ¼zÃ¼ kullanmamak
// const UserSchema: Schema = new Schema({...});
// const UserModel = mongoose.model('User', UserSchema); // Tip gÃ¼venliÄŸi yok

// âŒ YANLIÅ: Ä°liÅŸkilerde `ref` belirtmemek
// const PostSchema = new Schema({ author: Schema.Types.ObjectId }); // ref: 'User' eksik

// âŒ YANLIÅ: Gerekli alanlar iÃ§in `required` kullanmamak
// const ProductSchema = new Schema({ name: String, price: Number }); // name ve price zorunlu olmalÄ±

// âŒ YANLIÅ: MetotlarÄ± doÄŸrudan ÅŸema tanÄ±mÄ±na eklemek
// const UserSchema = new Schema({ name: String, greet: function() {} }); // schema.methods kullanÄ±lmalÄ±
```

## ğŸ” Kontrol Listesi

### Kod Kalitesi
- [ ] Her model ayrÄ± bir dosyada mÄ± (`*.model.ts`)?
- [ ] TypeScript arayÃ¼zÃ¼ (`interface`) tanÄ±mlanmÄ±ÅŸ mÄ±?
- [ ] Alan tipleri doÄŸru ve aÃ§Ä±kÃ§a belirtilmiÅŸ mi?
- [ ] Gerekli alanlar (`required`) iÅŸaretlenmiÅŸ mi?
- [ ] Benzersiz alanlar (`unique`) iÅŸaretlenmiÅŸ mi?
- [ ] Ä°liÅŸkiler iÃ§in `ref` doÄŸru ÅŸekilde kullanÄ±lmÄ±ÅŸ mÄ±?
- [ ] `timestamps` seÃ§eneÄŸi kullanÄ±lÄ±yor mu (genellikle Ã¶nerilir)?
- [ ] Model, tip arayÃ¼zÃ¼ ile birlikte mi oluÅŸturulmuÅŸ (`mongoose.model<IArayuz>(...)`)?

### Teknik Gereksinimler
- [ ] Temel doÄŸrulamalar (uzunluk, format vb.) eklenmiÅŸ mi?
- [ ] Gerekli indeksler tanÄ±mlanmÄ±ÅŸ mÄ±?
- [ ] Gerekliyse Ã¶rnek/statik metotlar doÄŸru ÅŸekilde (`schema.methods`/`schema.statics`) tanÄ±mlanmÄ±ÅŸ mÄ±?
- [ ] Gerekliyse sanal alanlar (`schema.virtual`) kullanÄ±lmÄ±ÅŸ mÄ±?

## ğŸ“ Kural Ä°Ã§eriÄŸi YÃ¶nergeleri
- TypeScript arayÃ¼z tanÄ±mÄ± ile baÅŸlayÄ±n.
- DetaylÄ± `Schema` tanÄ±mÄ±nÄ± ekleyin (tipler, required, default, unique, enum, ref).
- Åema seÃ§eneklerini (`timestamps`, `toJSON` vb.) aÃ§Ä±klayÄ±n.
- Sanal alanlar, metotlar ve statiklerin nasÄ±l ekleneceÄŸini gÃ¶sterin.
- Ä°ndekslemenin Ã¶nemini ve nasÄ±l yapÄ±lacaÄŸÄ±nÄ± belirtin.
- Modelin nasÄ±l oluÅŸturulup dÄ±ÅŸa aktarÄ±lacaÄŸÄ±nÄ± gÃ¶sterin.

## ğŸ”„ Kural BakÄ±mÄ±
- Yeni Mongoose sÃ¼rÃ¼mleri Ã§Ä±ktÄ±kÃ§a gÃ¼ncelleyin.
- YaygÄ±n kullanÄ±lan doÄŸrulama veya metot desenlerini ekleyin.
- Performansla ilgili en iyi uygulamalarÄ± (indeksleme vb.) gÃ¼ncel tutun.

## ğŸ§ª Testler
### Birim Testleri
- [ ] Model oluÅŸturma ve kaydetme iÅŸlemlerini test edin.
- [ ] DoÄŸrulama kurallarÄ±nÄ± test edin (gerekli, benzersiz, format vb.).
- [ ] Ã–rnek metotlarÄ±n doÄŸru Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± test edin.
- [ ] Statik metotlarÄ±n doÄŸru Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± test edin.
- [ ] Sanal alanlarÄ±n doÄŸru deÄŸerler dÃ¶ndÃ¼rdÃ¼ÄŸÃ¼nÃ¼ test edin.

## ğŸ’¡ Ä°puÃ§larÄ±
- `trim: true` kullanarak string alanlarÄ±n baÅŸÄ±ndaki/sonundaki boÅŸluklarÄ± otomatik temizleyin.
- `lowercase: true` veya `uppercase: true` kullanarak otomatik bÃ¼yÃ¼k/kÃ¼Ã§Ã¼k harf dÃ¶nÃ¼ÅŸÃ¼mÃ¼ yapÄ±n.
- KarmaÅŸÄ±k doÄŸrulamalar iÃ§in `validate` fonksiyonunu kullanÄ±n.
- Alt dÃ¶kÃ¼manlar yerine mÃ¼mkÃ¼n olduÄŸunca referanslarÄ± (`ref`) tercih edin (performans ve yÃ¶netim kolaylÄ±ÄŸÄ± iÃ§in).
- `lean()` metodu ile sorgu sonuÃ§larÄ±nÄ± saf JavaScript objeleri olarak alarak performansÄ± artÄ±rabilirsiniz (eÄŸer Mongoose metotlarÄ±na/sanallarÄ±na ihtiyaÃ§ yoksa).
- Gerekli olmayan alanlarÄ± sorgulardan Ã§Ä±karmak iÃ§in `select: false` kullanÄ±n.
